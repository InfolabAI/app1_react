# 리뷰 샘플링 알고리즘 설계 문서

## 1. 개요

이 문서는 서버 측에서 수행되던 리뷰 데이터 샘플링 기능을 클라이언트로 이동하기 위한 알고리즘 설계를 설명합니다. 샘플링 알고리즘의 목적은 다양성과 품질을 고려하여 대표성 있는 리뷰 샘플을 추출하는 것입니다.

## 2. 알고리즘 핵심 컴포넌트

### 2.1 텍스트 품질 평가 (evaluateTextQuality)

텍스트의 다양한 특성을 분석하여 품질 점수를 계산합니다:

1. **단어 빈도 분석**: 특정 단어가 과도하게 반복되는지 확인
2. **문자 바이그램 분석**: 문자 쌍의 분포와 엔트로피 계산
3. **반복 패턴 감지**: 연속된 문자나 단어의 반복 감지
4. **단어 다양성 (TTR)**: 고유 단어 비율 계산
5. **문장 구조 검사**: 적절한 문장 구조와 길이 평가
6. **문자 다양성 비율**: 다양한 문자 사용 비율

### 2.2 유사도 계산 (jaccardSimilarity)

두 텍스트 간의 단어 유사성을 Jaccard 유사도를 사용하여 계산합니다:
- 두 텍스트에서 공통으로 사용된 단어의 비율 (교집합/합집합)
- 유사도가 낮을수록 두 텍스트는 서로 다른 내용을 담고 있다고 평가

### 2.3 샘플링 프로세스 (sampleReviews)

1. **리뷰 필터링**: 너무 짧거나 긴 리뷰 제외 (50자 미만, 400자 초과)
2. **리뷰 정렬**: 최근 리뷰 우선 정렬 (선택적)
3. **리뷰 수 제한**: 처리할 리뷰 제한 (최대 500개)
4. **품질 평가**: 각 리뷰의 품질 점수 계산
5. **후보 선택**: 품질 점수 기준 상위 100개 (또는 그 이하) 선택
6. **첫 리뷰 선택**: 품질(70%)과 길이(30%)를 고려해 가장 좋은 리뷰 선택
7. **추가 리뷰 선택**: 품질(10%)과 다양성(90%)을 고려해 순차적으로 선택
8. **길이 제한**: 선택된 리뷰의 총 길이가 5000자를 넘지 않도록 제한

### 2.4 비동기 처리 및 진행 상황 추적

- **배치 처리**: UI 반응성을 위해 리뷰 처리를 배치로 분할
- **setTimeout 사용**: 메인 스레드 블로킹 방지
- **진행 상황 콜백**: 처리 진행 상황을 외부로 보고

## 3. 시간 복잡도 분석

### 3.1 텍스트 품질 평가 함수

- 단어 빈도 분석: O(n) - n은 단어 수
- 문자 바이그램 분석: O(m) - m은 문자 수
- 빈도/엔트로피 계산: O(k) - k는 고유 바이그램 수 (일반적으로 k << m)
- 반복 패턴 감지: O(m) - m은 문자 수
- 문자 다양성 계산: O(m)

**총 시간 복잡도**: O(n + m) - 텍스트 길이에 선형 비례

### 3.2 유사도 계산 함수

- 단어 집합 생성: O(n₁ + n₂) - n₁, n₂는 각 텍스트의 단어 수
- 교집합/합집합 계산: O(n₁ + n₂)

**총 시간 복잡도**: O(n₁ + n₂)

### 3.3 샘플링 프로세스

- 리뷰 품질 평가: O(R × (N + M)) - R은 리뷰 수, N은 평균 단어 수, M은 평균 문자 수
- 품질 기반 정렬: O(R log R)
- 후보 선택: O(R)
- 최적 리뷰 선택: O(C² × (N₁ + N₂)) - C는 후보 수, N₁, N₂는 평균 단어 수

**총 시간 복잡도**: O(R × (N + M) + R log R + C² × (N₁ + N₂))

## 4. 공간 복잡도 분석

### 4.1 텍스트 품질 평가 함수

- 단어 저장: O(n) - n은 단어 수
- 바이그램 저장: O(min(m², a)) - m은 텍스트 길이, a는 알파벳 크기의 제곱
- 기타 변수: O(1)

**총 공간 복잡도**: O(n + min(m², a))

### 4.2 샘플링 프로세스

- 원본 리뷰 저장: O(R)
- 품질 점수 저장: O(R)
- 선택된 리뷰 저장: O(S) - S는 선택된 리뷰 수 (일반적으로 S << R)
- 누적 텍스트 저장: O(T) - T는 선택된 텍스트의 총 길이

**총 공간 복잡도**: O(R + T)

## 5. 최적화 방안

1. **메모 이용**: 동일한 패턴에 대한 반복 계산 회피
2. **배치 처리**: UI 블로킹 방지를 위한 처리 분할
3. **리뷰 필터링**: 품질 낮은 리뷰 사전 제외
4. **인덱스 사용**: 원본 리뷰 복사 대신 인덱스 관리
5. **선형 탐색 최소화**: 리뷰 특성에 따라 우선순위 부여

## 6. 한계점 및 향후 개선 방향

1. **언어 특수성**: 한국어 특성에 맞춘 품질 평가 규칙 추가 필요
2. **리뷰 맥락 이해**: 단순 단어 빈도 외 맥락 이해를 위한 기법 도입
3. **동적 매개변수**: 리뷰 특성에 따른 가중치 동적 조정
4. **캐싱 전략**: 자주 접근하는 계산 결과 캐싱
5. **Web Worker 활용**: 별도 스레드에서 무거운 계산 처리 검토